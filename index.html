<!DOCTYPE html>
<html>
  <head>
    <title>FOSIPULATOR</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #f4f4f4;
      }
      .title {
        color: #333;
      }
      .input-field {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        box-sizing: border-box;
        border-radius: 4px;
        border: 1px solid #ccc;
      }
      .select-field {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        box-sizing: border-box;
        border-radius: 4px;
        border: 1px solid #ccc;
      }
      .calculate-button {
        background-color: #4caf50;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 10px 0;
        cursor: pointer;
        border: none;
        border-radius: 4px;
      }
      .result {
        margin-top: 20px;
        padding: 20px;
        border-radius: 4px;
        border: 1px solid #ccc;
        background-color: #fff;
      }
    </style>
  </head>
  <body>
    <h1 class="title">FOSIPULATOR</h1>
    <p>Enter your sequences (comma-separated):</p>
    <input
      class="input-field"
      id="sequence1"
      type="text"
      placeholder="Sequence 1"
    />
    <br />
    <input
      class="input-field"
      id="sequence2"
      type="text"
      placeholder="Sequence 2"
    />
    <br />
    <select class="select-field" id="convolutionType" onchange="toggleInput()">
      <option value="linear">Linear Convolution</option>
      <option value="circular">Circular Convolution</option>
      <option value="correlation">Correlation</option>
      <option value="dft">DFT</option>
      <option value="idft">IDFT</option>
    </select>
    <br />
    <button class="calculate-button" onclick="calculate()">Get Result</button>
    <div class="result" id="result"></div>

    <footer style="position: fixed; left: 0; bottom: 0; width: 100%; background-color: #333; color: white; text-align: center; padding: 10px;">
        <p>Made with ❤️ by <a href="https://github.com/Dare-marvel/" target="_blank" style="color: #61dafb;">Dare-marvel</a></p>
    </footer>
    
    <script>
      function toggleInput() {
        let type = document.getElementById("convolutionType").value;
        let sequence2 = document.getElementById("sequence2");
        if (type === "dft") {
          sequence2.style.display = "none";
        } else {
          sequence2.style.display = "block";
        }
      }
      toggleInput(); // Call the function to set the initial state
      function calculate() {
        var sequence1 = document
          .getElementById("sequence1")
          .value.split(",")
          .map(Number);
        var sequence2 = document
          .getElementById("sequence2")
          .value.split(",")
          .map(Number);
        var convolutionType = document.getElementById("convolutionType").value;
        var result;

        switch (convolutionType) {
          case "linear":
            result = convolute(sequence1, sequence2);
            break;
          case "circular":
            result = circularConvolute(sequence1, sequence2);
            break;
          case "correlation":
            result = correlate(sequence1, sequence2);
            break;
          case "dft":
            result = dft(sequence1, new Array(sequence1.length).fill(0));
            break;
          case "idft":
            result = idft(sequence1, sequence2);
            break;
          // Add more cases as needed for other types of convolutions

          default:
            // Handle the case when convolutionType doesn't match any of the expected values
            console.error("Invalid convolution type:", convolutionType);
        }
        document.getElementById("result").innerHTML =
          "Result: " + result.join(", ");
      }

      function convolute(x, h) {
        var y = [];
        var m = x.length;
        var n = h.length;
        for (var i = 0; i < m + n - 1; i++) {
          y[i] = 0;
          for (var j = Math.max(0, i - (n - 1)); j <= Math.min(i, m - 1); j++) {
            y[i] += x[j] * h[i - j];
          }
        }
        return y;
      }

      function circularConvolute(x, h) {
        var N = Math.max(x.length, h.length);
        var y = new Array(N).fill(0);
        var temp = new Array(N).fill(0);
        var signal = new Array(N).fill(0);
        var sum, i, j, p, q, s, t;

        // Pad the sequences with zeros
        while (x.length < N) x.push(0);
        while (h.length < N) h.push(0);

        // Reverse the signal
        j = 0;
        for (i = 0; i < N; i++) {
          j = N - 1 - i;
          temp[i] = h[j];
        }

        for (s = 0; s < N; s++) {
          p = 0;
          for (t = 0; t < N; t++) {
            if (t <= s) {
              q = t - s + N - 1;
              signal[t] = temp[q];
            } else {
              signal[t] = temp[p];
              p++;
            }
          }
          sum = 0;
          for (i = 0; i < N; i++) {
            sum += x[i] * signal[i];
          }
          y[s] = sum;
        }

        return y;
      }

      function correlate(x, h) {
        const N = 20;
        const M = 10;
        let i, j;
        let nneg, npos;
        let temp = 0;
        let stx, sth;
        let lx = x.length;
        let lh = h.length;
        let y = new Array(N).fill(0);

        // Detect start index and actual length of the signals
        [stx, lx] = detect(x, lx);
        [sth, lh] = detect(h, lh);

        console.log(`stx = ${stx}  lx = ${lx}`);
        console.log(`sth = ${sth}  lh = ${lh}`);

        // Determine number of values in the correlation
        nneg = sth - stx + lh - 1;
        npos = lx - (sth - stx);
        console.log(`nneg = ${nneg}  npos = ${npos}`);

        for (i = -1 * nneg; i < npos; i++) {
          temp = 0;
          for (j = stx; j < stx + lx; j++) {
            if (x[j] !== undefined && h[j - i] !== undefined) {
              temp += x[j] * h[j - i];
            }
          }
          y[M + i] = temp;
        }

        return y.slice(M - nneg, M + npos);
      }

      function detect(a, len) {
        let i = 0,
          s = 0;
        while (s === 0 && i < len) {
          if (a[i] !== 0) s = 1;
          i++;
        }
        len = len - i + 1;
        return [i - 1, len];
      }

      function dft(a, b) {
        let N = a.length;
        let A = new Array(N).fill(0);
        let B = new Array(N).fill(0);
        let omega = (2 * Math.PI) / N;

        for (let k = 0; k < N; k++) {
          for (let n = 0; n < N; n++) {
            let arg = omega * k * n;
            let c = Math.cos(arg);
            let d = Math.sin(arg);

            // (a+jb)(c+jd) = (ac - bd ) + j (bc + ad)
            A[k] = A[k] + a[n] * c + b[n] * d;
            B[k] = B[k] - a[n] * d + b[n] * c;
          }
        }

        // Create an array of complex numbers in the format "A + jB"
        let result = A.map(
          (A_i, i) => `${A_i.toFixed(2)} + j${B[i].toFixed(2)}`
        );
        return result;
      }

      function idft(A, B) {
        let N = A.length;
        let a = new Array(N).fill(0);
        let b = new Array(N).fill(0);
        let omega = (2 * Math.PI) / N;

        for (let k = 0; k < N; k++) {
          for (let i = 0; i < N; i++) {
            let arg = omega * k * i;
            let c = Math.cos(arg);
            let d = Math.sin(arg);

            // (a+jb)(c+jd) = (ac - bd ) + j (bc + ad)
            a[k] = a[k] + A[i] * c - B[i] * d;
            b[k] = b[k] + A[i] * d + B[i] * c;
          }

          // Normalize the results
          a[k] = a[k] / N;
          b[k] = b[k] / N;
        }

        let result = a.map(
          (a_i, i) => `${a_i.toFixed(2)} + j${b[i].toFixed(2)}`
        );
        return result;
      }
    </script>
  </body>
</html>
